!function(t,e){"use strict";var a=function(e,a){this.el=t(e),this.$notification=null,this.$widget=null,this.orgPadding=null,this.severity=null,this.defaults={archivedPath:"/ou-alerts/archived-alerts.xml",activePath:"/ou-alerts/active-alerts.xml",icon:!1,title:!0,subtitle:!0,description:!0,link:!0,date:!0,dateFormat:"",delay:!1,closeOnClick:!0,popup:!0,showRecent:!0,showClass:"fadeInDown",hideClass:"zoomOut",animationType:"animated-fast",emergency:{class:"oualerts-notify-error",position:"modal",icon:"fa fa-exclamation-triangle",iconColor:"#F44336",fontColor:"",backgroundColor:"#FFC5C0",template:!1},warning:{class:"oualerts-notify-warning",position:"top",icon:"fa fa-exclamation-circle",iconColor:"#f08a24",fontColor:"",backgroundColor:"#FFE5C0",template:!1},announcement:{class:"oualerts-notify-info",position:"top",icon:"fa fa-bullhorn",iconColor:"#6091ba",fontColor:"",backgroundColor:"#B3CFE8",template:!1},widgetTemplate:!1,archiveHeader:!0},t.extend(!0,this.defaults,a),this.init()};function i(t){return"[object Array]"===Object.prototype.toString.call(t)}a.prototype.init=function(){var t=this;this.loading(),"active"===this.defaults.type?this.fetch("active").then(function(e){e&&void 0!==e.alert&&(!0===t.defaults.popup?t.notify(e,t.defaults):(t.loading(!0),t.widget(e,t.defaults)))}):this.fetch("archived").then(function(e){e&&void 0!==e.archive&&(t.loading(!0),t.widget(e,t.defaults,!0))})},a.prototype.fetch=function(e){var a=this,i=t.Deferred(),n="active"===e?this.defaults.activePath:this.defaults.archivedPath;return t.ajax({type:"GET",url:n,cache:!1,dataType:"xml",success:function(t){"active"===e?i.resolve(a.prepareData(d(t))):i.resolve(a.prepareArchivedData(d(t)))},error:function(t){i.reject(t)}}),i},a.prototype.widget=function(t,e,a){"function"==typeof e.widgetTemplate?this.$widget=e.widgetTemplate(t,e):this.$widget=a?n(t,e):r(t,e),this.el.html(this.$widget)},a.prototype.notify=function(e,a){var i=this;if(this.severity=e.alert["ou:severity"].toLowerCase(),"function"==typeof i.defaults[i.severity].template)this.$notification=i.defaults[i.severity].template(e,a);else if(a.showRecent){var n=[];n.push(e.alert),(n=n.concat(e.updates)).sort(function(t,e){return new Date(e.pubDate)-new Date(t.pubDate)}),n[0]["ou:severity"]=e.alert["ou:severity"],this.$notification=this.createNotificationTemplate(n[0],a)}else this.$notification=this.createNotificationTemplate(e.alert,a);a.closeOnClick&&t("body").click(function(){i.remove()}),a.delay?setTimeout(function(){i.el.append(i.$notification),"top"===i.defaults[i.severity].position&&i.applyPadding()},a.delay):(this.el.append(this.$notification),"top"===i.defaults[i.severity].position&&i.applyPadding())},a.prototype.calcPadding=function(t){var e=t+this.$notification.height()+"px";this.el.css("padding-top",e)},a.prototype.applyPadding=function(){t("body").addClass("ou-alerts-active"),this.orgPadding=parseInt(this.el.css("padding-top")),this.calcPadding(this.orgPadding),t(e).resize(this.calcPadding(this.orgPadding))},a.prototype.remove=function(){var a=this;t("body").removeClass("ou-alerts-active"),"top"===this.defaults[this.severity.toLowerCase()].position&&this.el.css("padding-top",this.orgPadding),this.$notification.removeClass(this.defaults.showClass).addClass(this.defaults.hideClass),e.AnimationEvent?this.$notification.on("oanimationend animationend webkitAnimationEnd",function(){a.$notification.remove()}):a.$notification.remove()},a.prototype.prepareArchivedData=function(e){var a,n=[];if(!e.rss.channel.item)return!1;if(i(e.rss.channel.item)){if(!e.rss.channel.item||void 0===e.rss.channel.item[0]||void 0===e.rss.channel.item[0].title["#text"])return!1}else if(void 0===e.rss.channel.item.title)return!1;return a=e.rss.channel.item&&!e.rss.channel.item.length?[e.rss.channel.item]:e.rss.channel.item,t.each(a,function(e,i){"alert"===i["dc:type"]["#text"]&&(i.updates=[],t.each(a,function(t,e){"update"===e["dc:type"]["#text"]&&e["dc:identifier"]["#text"]===i["dc:identifier"]["#text"]&&i.updates.push(c(e))}),n.push(c(i)))}),{archive:n,channel:{description:e.rss.channel.description["#text"],language:e.rss.channel.language["#text"],lastBuildDate:e.rss.channel.lastBuildDate["#text"],link:e.rss.channel.link["#text"],title:e.rss.channel.title["#text"]}}},a.prototype.prepareData=function(e){var a,n,s=[];if(!e.rss.channel.item)return!1;if(i(e.rss.channel.item)){if(!e.rss.channel.item||void 0===e.rss.channel.item[0]||void 0===e.rss.channel.item[0].title["#text"])return!1}else if(void 0===e.rss.channel.item.title)return!1;return n=e.rss.channel.item&&!e.rss.channel.item.length?[e.rss.channel.item]:e.rss.channel.item,t.each(n,function(t,e){"alert"===e["dc:type"]["#text"]?a=c(e):"update"===e["dc:type"]["#text"]&&s.push(c(e))}),s.length&&s.sort(function(t,e){return new Date(e.pubDate)-new Date(t.pubDate)}),{alert:a,updates:s,channel:{description:e.rss.channel.description["#text"],language:e.rss.channel.language["#text"],lastBuildDate:e.rss.channel.lastBuildDate["#text"],link:e.rss.channel.link["#text"],title:e.rss.channel.title["#text"]}}},a.prototype.loading=function(t){this.defaults.popup||t?t&&(this.el.addClass("ready"),this.el.removeClass("loading")):this.el.addClass("loading")};var n=function(e,a){var i=t('<div class="oualerts-archive-wrapper"></div>'),n=t("<h2>Archived Alerts</h2>"),r=t('<ul class="oualerts-archive-list"></ul>');return t.each(e.archive,function(e,i){var n=s(i,a),l=t('<li class="oualerts-archive"></li>'),c=t('<ul class="oualerts-update-cont"/>');if(l.append(n),i.updates&&i.updates.length){var d=t('<h4 class="oualerts-archive-update-header">UPDATES</h4>');l.append(d),l.append("<hr/>"),l.append(c),t.each(i.updates,function(e,n){var s=o(n,a,!0),r=t('<li class="oualerts-archive-update"></li>');e===i.updates.length-1?r.append(s):r.append(s).append("<hr/>"),c.append(r)}),l.append(c)}r.append(l)}),a.archiveHeader&&i.append(n),i.append(r),i},s=function(e,a){var i=t("<article/>"),n=t('<div class="oualerts-date">'+l(e.pubDate)+"</div>"),s=t('<h2 class="oualerts-title"></h2>');s.text(e.title);var o=t('<p class="oualerts-msg"></p>');if(o.text(e.description),a.icon){var r,c=a[e["ou:severity"].toLowerCase()].icon;if(c.indexOf("/")>-1)r=t('<img class="oualerts-title-icon" src="'+c+'" alt="Alert Icon"/>');else{r=t('<i class="'+c+'"></i>');var d=a[e["ou:severity"].toLowerCase()].iconColor;d&&r.css({color:d})}s.prepend(r)}if(i.append(n).append(s),e["ou:subtitle"]){var p=t('<h3 class="oualerts-subtitle"></h3>');p.text(e["ou:subtitle"]),i.append(p)}return i.append(o),i},o=function(e,a,i){var n=t("<article/>"),s=t('<div class="oualerts-date oualerts-active-update-date">'+l(e.pubDate)+"</div>"),o=t('<h5 class="'+(i?"":"oualerts-active-update-title")+'"></h5>'),r=t('<p class="oualerts-active-update-msg"></p>');return o.text(e.title),r.text(e.description),n.append(s).append(o).append(r),n},r=function(e,a){var i=s(e.alert,a),n=t('<h4 class="oualerts-active-update-title">UPDATES</h4>'),r=t('<ul class="oualerts-active-update-list"/>');return t.each(e.updates,function(i,n){var s=t('<li class="oualerts-active-update"></li>');s.append(o(n,a)),i===e.updates.length-1?r.append(s):r.append(s).append("<hr/>")}),e.updates.length&&i.append(n).append("<hr/>").append(r),i};function l(t){var e=new Date(t),a=e.getHours()>=12?"PM":"AM",i=(e.getMinutes()<10?"0":"")+e.getMinutes(),n=e.getHours();n>12?n-=12:0===n&&(n=12);var s=" "+n+":"+i+" "+a;return["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()+s}function c(e){for(var a in e)e[a]["#text"]?e[a]=e[a]["#text"]:t.isEmptyObject(e[a])&&(e[a]="");return e}function d(t){var e={};if(3==t.nodeType&&(e=t.nodeValue),t.hasChildNodes())for(var a=0;a<t.childNodes.length;a++){var i=t.childNodes.item(a),n=i.nodeName;if(void 0===e[n])e[n]=d(i);else{if(void 0===e[n].push){var s=e[n];e[n]=[],e[n].push(s)}e[n].push(d(i))}}return e}a.prototype.createNotificationTemplate=function(e,a){var i,n,s=this,o=a[e["ou:severity"].toLowerCase()],r=o.position,c=t("<div></div>",{class:"oualerts-notify "+o.class+" "+a.animationType+" "+a.showClass});if(i=t('<div class="oualerts-notify-body"/>'),a.date){var d=l(e.pubDate),p=t('<div class="oualerts-notify-date">'+d+"</div>");i.append(p)}if(a.title){var u=t('<h3 class="oualerts-notify-title"></h3>');if(u.text(e.title),a.icon){var h=t('<i class="'+o.icon+'"></i>'),f=o.iconColor;f&&h.css({color:f}),u.prepend(h)}i.append(u)}if(a.subtitle&&e["ou:subtitle"]){var v=t('<h4 class="oualerts-notify-subtitle"></h4>');v.text(e["ou:subtitle"]),i.append(v)}if(a.description){var g=t('<p class="oualerts-notify-msg"></p>');if(g.text(e.description),a.link&&e.guid&&e.guid.indexOf(".xml")<0){var m='&nbsp;<a href="'+e.guid+'" target="_blank" class="oualerts-notify-link">Read More...</a>';g.append(m)}i.append(g)}n=t('<p class="oualerts-notify-footer"></p>'),t('<button class="oualerts-close-button'+(o.buttonClass?" "+o.buttonClass.trim():"")+'">'+(o.buttonText?o.buttonText.trim():"Close")+"</button>").on("click",function(){s.remove()}).appendTo(n),i.append(n),c.append(i);var y=o.backgroundColor;y&&c.css({backgroundColor:y});var b=o.fontColor;return b&&c.css({color:b}),"bottom"===r?c.addClass("oualerts-bottom"):"top"===r?c.addClass("oualerts-top"):"modal"===r&&(c.addClass("oualerts-modal"),o.modalSize?c.addClass(o.modalSize):c.addClass("large"),c=t('<div class="oualerts-notify-modal-overlay"/>').append(c)),c},t.fn.OUAlert=function(){for(var t=arguments[0],e=this.length,i=0;i<e;i++)this[i].OUAlert=new a(this[i],t);return this},e.OUAlerts=a}(jQuery,window);